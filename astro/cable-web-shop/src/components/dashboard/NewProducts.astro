---
import type { ProductT } from '../../firebase/utility/firestore'

export interface Props {
  products: ProductT[] | undefined
}

const { products } = Astro.props
---

<h2>Last added product</h2>
{
  products ? (
    <ul id="products">
      {products.map((product) => (
        <li>
          <div>
            <h2>{product.name}</h2>
            <button data-product-id={product.id}>Delete product</button>
            <br />
            <img src={product.imageUrl} alt={product.name} />
          </div>
        </li>
      ))}
    </ul>
  ) : (
    <p>No products in store!</p>
  )
}

<script>
  const productListEl = document.getElementById('products')
  productListEl?.addEventListener('click', (e) => {
    const clickedEl = e.target as HTMLElement
    // is button clicked
    if (clickedEl.hasAttribute('data-product-id')) {
      const productId = clickedEl.dataset.productId
      productId && sendeDeleteProductRequest(productId)
    }
  })

  async function sendeDeleteProductRequest(id: string) {
    if (!confirm('Delete product from store. Are you shure?')) return

    const res = await fetch('/api/products', {
      method: 'delete',
      body: JSON.stringify({ id }),
    })
    const data = await res.json()

    console.log(data)
  }
</script>
